# Checkout App

[Saleor App](https://docs.saleor.io/docs/3.x/developer/extending/apps/key-concepts) for payment gateways configuration and layout customisation of [Saleor Checkout](https://github.com/saleor/saleor-checkout/blob/main/apps/checkout/README.md)

## Setup

### Development

Start tunnel, so that Checkout App is available from Internet for webhooks:

```bash
npx saleor app tunnel 3000
```

> You can also use [`ngrook`](https://ngrok.com/), but you would need to update env variables each time you open tunnel (on free plan) with new domain `ngrook` assigned you
> The tunnel needs to use `https` with valid SSL certificate

Create [environment variables](#env-variables) config file

```bash
cp .env.template .env.local
```

Edit `.env.local` file and fill in values for environment variables

> Note: For development environment variables are applied [in this order](https://nextjs.org/docs/basic-features/environment-variables#environment-variable-load-order):
> - `.env`
> - `.env.development`
> - `.env.local`
> 
> For example: if `.env.local` has a variable with the same name as in `.env.development` it will override variable from `.env.development`

Run the development server:

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

### Production

To build for production, run the following command:

```bash
cd ../.. && pnpm run build:payments-app
```

> Note: The command needs to be run from root of the monorepo. Otherwise Turborepo won't be able to build the app

## Env Variables

**Environment variables contain secrets that can lead to compromising your store data**

When **deploying** to Vercel you can set them on the [configuration page](https://vercel.com/docs/concepts/projects/environment-variables)

When running app **locally** you can use the [`.env.local`](https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables) file. **It should not be included in your git repository**. An example configuration is available in `.env.template`

### Backend variables

- `SALEOR_APP_ID` — ID assigned by Saleor after the app was installed
- `SALEOR_APP_TOKEN` — App's token generated by Saleor after the app was installed
- `SETTINGS_ENCRYPTION_SECRET` — Random string used for encrypting apps configuration

To generate a random secret you can use openssl:
```
openssl rand -hex 256
```

[Learn more](https://docs.saleor.io/docs/3.x/developer/extending/apps/installing-apps#installing-third-party-apps) about installing third-party apps in [Saleor docs](https://docs.saleor.io/docs/3.x/developer/extending/apps/installing-apps#installing-third-party-apps)

### Frontend variables

Each variable starting with [`NEXT_PUBLIC`](https://nextjs.org/docs/basic-features/environment-variables#exposing-environment-variables-to-the-browser) is exposed to frontend

- `NEXT_PUBLIC_SALEOR_API_URL` — URL of your Saleor GraphQL API

> Note: by default `SALEOR_API_URL` env variable from root of monorepo is used for the value. If you want to customise it, you can add a separate `.env.local` file, which won't be stored in git repository
